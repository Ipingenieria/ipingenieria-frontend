
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crear Cotizaci√≥n - IP INGENIER√çA Y AUTOMATISMO SAS</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f8f8f8; }
    h1 { text-align: center; }
    label { font-weight: bold; display: block; margin-top: 10px; }
    input, select, textarea { width: 100%; padding: 6px; margin-top: 4px; }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; background: #fff; }
    th, td { padding: 8px; border: 1px solid #ddd; text-align: left; }
    button { padding: 10px 15px; margin-top: 15px; cursor: pointer; }
    .add-item { background-color: #4CAF50; color: white; border: none; }
    .save { background-color: #2196F3; color: white; border: none; }
  </style>
</head>
<body>

<h1>üßæ Crear Cotizaci√≥n</h1>

<form id="formCotizacion">
  <label for="cliente_id">Cliente</label>
  <select id="cliente_id" required>
    <option value="">Seleccione un cliente</option>
  </select>

  <label for="encabezado_tipo">Tipo de encabezado</label>
  <select id="encabezado_tipo">
    <option>Cotizaci√≥n t√©cnica</option>
    <option>Propuesta econ√≥mica</option>
    <option>Oferta comercial</option>
  </select>

  <label for="forma_pago">Forma de pago</label>
  <input type="text" id="forma_pago" />

  <label for="vigencia_dias">Vigencia (d√≠as)</label>
  <input type="number" id="vigencia_dias" value="15"/>

  <label for="observaciones_generales">Observaciones generales</label>
  <textarea id="observaciones_generales"></textarea>

  <h2>üì¶ √çtems de la cotizaci√≥n</h2>
  <table id="tablaItems">
    <thead>
      <tr>
        <th>Descripci√≥n</th>
        <th>Unidad</th>
        <th>Cant.</th>
        <th>Valor Unitario</th>
        <th>IVA (%)</th>
        <th>Total</th>
        <th></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button type="button" class="add-item" onclick="agregarItem()">‚ûï Agregar √çtem</button>

  <h3>Total: $<span id="totalGeneral">0.00</span></h3>
  <button type="submit" class="save">üíæ Guardar Cotizaci√≥n</button>
</form>

<script>
// Script b√°sico que ser√° conectado con Supabase y c√°lculo de totales
function agregarItem() {
  const fila = document.createElement("tr");
  fila.innerHTML = `
    <td><input type="text" class="descripcion" required /></td>
    <td><input type="text" class="unidad" /></td>
    <td><input type="number" class="cantidad" value="1" min="1" onchange="calcularTotales()" /></td>
    <td><input type="number" class="valor_unitario" value="0" min="0" onchange="calcularTotales()" /></td>
    <td><input type="number" class="iva" value="0" min="0" max="100" onchange="calcularTotales()" /></td>
    <td class="total_item">$0.00</td>
    <td><button type="button" onclick="this.parentElement.parentElement.remove(); calcularTotales();">üóëÔ∏è</button></td>
  `;
  document.querySelector("#tablaItems tbody").appendChild(fila);
}

function calcularTotales() {
  let total = 0;
  document.querySelectorAll("#tablaItems tbody tr").forEach(row => {
    const cantidad = parseFloat(row.querySelector(".cantidad").value) || 0;
    const valor = parseFloat(row.querySelector(".valor_unitario").value) || 0;
    const iva = parseFloat(row.querySelector(".iva").value) || 0;
    const subtotal = cantidad * valor;
    const totalItem = subtotal + (subtotal * iva / 100);
    row.querySelector(".total_item").textContent = "$" + totalItem.toFixed(2);
    total += totalItem;
  });
  document.getElementById("totalGeneral").textContent = total.toFixed(2);
}
</script>

</body>
</html>
